import{c as T,r as d,S as q,j as s,X as ae,a as ne,b as ie}from"./index-2444a23b.js";/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=T("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=T("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=T("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),G=1,ge=({projects:N,tiles:U,meetings:I,selectedProjectId:g,createTask:W,settings:v})=>{const S=d.useRef(null),[C,M]=d.useState(""),[p,l]=d.useState([]),[o,f]=d.useState(g||"proj-default"),[B,O]=d.useState(!1),[u,A]=d.useState(!0),[V,P]=d.useState(!1),[x,h]=d.useState([]),[m,b]=d.useState("");d.useEffect(()=>{try{const t=sessionStorage.getItem(q.AGENT_CHAT),e=t?JSON.parse(t):null;e&&e.version===G?(l(e.messages||[]),f(e.contextProjectId||g||"proj-default"),A(e.includeMeetings??!0),h(e.selectedMeetingIds||[]),b(e.transcriptText||"")):(l([{id:`a-${Date.now()}`,role:"assistant",text:"Hi! Ask me to suggest tasks for your current project."}]),f(g||"proj-default"),A(!0),h([]),b(""))}catch{l([{id:`a-${Date.now()}`,role:"assistant",text:"Hi! Ask me to suggest tasks for your current project."}]),f(g||"proj-default"),A(!0),h([]),b("")}},[g]),d.useEffect(()=>{try{sessionStorage.setItem(q.AGENT_CHAT,JSON.stringify({version:G,messages:p,contextProjectId:o,includeMeetings:u,selectedMeetingIds:x,transcriptText:m}))}catch{}},[p,o,u,x,m]),d.useEffect(()=>{var t;(t=S.current)==null||t.scrollTo({top:S.current.scrollHeight,behavior:"smooth"})},[p.length]);const j=t=>l(e=>[...e,t]),E=(t,e)=>l(a=>a.map(r=>r.id===t?e(r):r)),Z=async t=>{var F,H,_,z,K;const e=(F=v==null?void 0:v.apiKey)==null?void 0:F.trim();if(!e){j({id:`a-${Date.now()}`,role:"assistant",text:"Please add your OpenAI API key in Settings."});return}const a=(u?I:[]).filter(i=>i.projectId===o).filter(i=>x.length===0?!0:x.includes(i.id)).map(i=>({...i}));m.trim()&&a.push({id:`transcript-${Date.now()}`,title:"Uploaded Transcript",projectId:o,notes:[{date:new Date().toISOString().slice(0,10),attendance:"",summary:m,actions:""}]});const r=ie(o,U,a),n=["You are a concise planning assistant in a dark UI task manager.","When user intent is ambiguous, ask a short follow-up question (one line).","When ready to propose tasks, reply with a JSON block only (no prose) using this schema:",'{"tasks":[{"label":"...","description":"...","owner":"","dueDate":"YYYY-MM-DD","priority":"low|normal|high|urgent","status":"todo|in-progress|review|done","category":"","tags":["..."]}]}',"Keep labels short. Prefer due dates within the next 2–4 weeks when relevant."].join(" "),y=p.filter(i=>!i.suggestions&&i.text).map(i=>({role:i.role,content:i.text})),re=`Selected Project: ${((H=N.find(i=>i.id===o))==null?void 0:H.name)||o}
Include meetings: ${u}
Project Context JSON:
${JSON.stringify(r)}
---
User: ${t}
If confident, output JSON only. Otherwise, ask one brief question.`,c=`t-${Date.now()}`;j({id:c,role:"assistant",text:"Thinking…",thinking:!0}),P(!0);try{const D=await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:"gpt-4o-mini",temperature:.4,messages:[{role:"system",content:n},...y,{role:"user",content:re}]})})).json(),L=((K=(z=(_=D==null?void 0:D.choices)==null?void 0:_[0])==null?void 0:z.message)==null?void 0:K.content)||"",k=Q(L),Y=Array.isArray(k==null?void 0:k.tasks)?k.tasks:[];Y.length?(E(c,()=>({id:c,role:"assistant",text:"I suggested some tasks below."})),j({id:`s-${Date.now()}`,role:"assistant",suggestions:X(Y)})):E(c,()=>({id:c,role:"assistant",text:L||"Could you clarify what you need?"}))}catch(i){E(c,()=>({id:c,role:"assistant",text:`Error: ${i.message}`}))}finally{P(!1)}},X=t=>t.map((e,a)=>({id:e.id||`sg-${Date.now()}-${a}`,label:(e.label||"").toString().slice(0,200),description:(e.description||"").toString().slice(0,1e3),owner:e.owner||"",dueDate:e.dueDate||"",priority:["low","normal","high","urgent"].includes(e.priority)?e.priority:"normal",status:["todo","in-progress","review","done"].includes(e.status)?e.status:"todo",category:e.category||"",tags:Array.isArray(e.tags)?e.tags.slice(0,10):[]})),Q=t=>{try{return JSON.parse(t)}catch{}const e=t.match(/\{[\s\S]*\}$/m)||t.match(/```json[\s\S]*?```/m);if(!e)return null;const a=e[0].startsWith("```")?e[0].replace(/```json|```/g,""):e[0];try{return JSON.parse(a)}catch{return null}},ee=(t,e)=>{l(a=>a.map(r=>{if(r.id!==t||!r.suggestions)return r;const n=r.suggestions.find(y=>y.id===e);return n&&W({label:n.label,description:n.description||"",owner:n.owner||"",dueDate:n.dueDate||null,priority:n.priority||"normal",status:n.status||"todo",category:n.category||"",tags:n.tags||[],projectId:o||g||"proj-default"}),{...r,suggestions:r.suggestions.filter(y=>y.id!==e)}}))},te=(t,e)=>{l(a=>a.map(r=>r.id===t&&r.suggestions?{...r,suggestions:r.suggestions.filter(n=>n.id!==e)}:r))},J=async t=>{t.preventDefault();const e=C.trim();e&&(j({id:`u-${Date.now()}`,role:"user",text:e,projectId:o}),M(""),await Z(e))},w=N.find(t=>t.id===o),R=I.filter(t=>t.projectId===o),$=t=>(t||"").replace(/[&<>]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[e]),se=t=>{if(!t)return"";let e=t.replace(/```([\s\S]*?)```/g,(a,r)=>`<div class="code-wrap"><button class="code-copy" data-code="${$(r)}">Copy</button><pre><code>${$(r)}</code></pre></div>`);return e=e.replace(/^###\s+(.+)$/gm,"<h3>$1</h3>"),e=e.replace(/(?:^|\n)(-\s.+(?:\n-\s.+)*)/g,a=>{const r=a.split(/\n/).filter(n=>n.trim().startsWith("- ")).map(n=>`<li>${$(n.trim().slice(2))}</li>`).join("");return r?`
<ul>${r}</ul>`:a}),e.replace(/\n/g,`
`)};return s.jsxs("div",{className:"bg-white rounded-xl shadow-md p-0 dark:bg-[#0F1115] dark:border dark:border-gray-800",children:[s.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:s.jsx("h2",{className:"text-sm font-medium tracking-wide text-gray-600 dark:text-gray-300",children:"AI Agent"})}),s.jsxs("div",{className:"h-[60vh] flex flex-col",children:[s.jsx("div",{ref:S,className:"flex-1 overflow-y-auto p-4 space-y-4 bg-[#fafafa] dark:bg-[#1E1E1E]",children:p.map(t=>t.suggestions?s.jsx("div",{className:"max-w-[80%] self-end p-0.5",children:s.jsxs("div",{className:"rounded-lg p-2 bg-transparent",children:[s.jsx("div",{className:"text-[11px] mb-2 text-gray-500 dark:text-gray-400",children:"Suggested tasks"}),s.jsxs("div",{className:"space-y-1.5",children:[t.suggestions.map(e=>s.jsxs("div",{className:"rounded-md p-2 text-[12px] bg-white/5 dark:bg-white/5 border border-white/10",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:e.label}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("button",{className:"px-2 py-1 rounded-full bg-emerald-500/90 text-white hover:bg-emerald-400 shadow-sm ring-0 hover:ring-2 hover:ring-emerald-400/30 transition",onClick:()=>ee(t.id,e.id),title:"Add",children:[s.jsx("span",{className:"sr-only",children:"Add"}),s.jsx(oe,{className:"w-4 h-4"})]}),s.jsxs("button",{className:"px-2 py-1 rounded-full bg-rose-500/90 text-white hover:bg-rose-400 shadow-sm ring-0 hover:ring-2 hover:ring-rose-400/30 transition",onClick:()=>te(t.id,e.id),title:"Remove",children:[s.jsx("span",{className:"sr-only",children:"Remove"}),s.jsx(ae,{className:"w-4 h-4"})]})]})]}),e.description&&s.jsx("div",{className:"mt-1 text-[11px] text-gray-300",children:e.description}),s.jsxs("div",{className:"mt-1 flex flex-wrap gap-2 text-[11px] text-gray-400",children:[e.owner&&s.jsxs("span",{children:["Owner: ",e.owner]}),e.dueDate&&s.jsxs("span",{children:["Due: ",e.dueDate]}),e.priority&&s.jsxs("span",{className:"capitalize",children:["Priority: ",e.priority]}),e.category&&s.jsxs("span",{children:["Phase: ",e.category]}),Array.isArray(e.tags)&&e.tags.length>0&&s.jsxs("span",{children:["Tags: ",e.tags.join(", ")]})]})]},e.id)),t.suggestions.length===0&&s.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:"No pending suggestions."})]})]})},t.id):s.jsx("div",{className:`max-w-[70%] px-0 py-0 text-[13px] chat-content ${t.thinking?"italic text-gray-400 dark:text-gray-300/70 animate-thinking self-end":t.role==="assistant"?"self-end text-[#F5F5F5]":"self-start text-[#E0E0E0]"}`,dangerouslySetInnerHTML:{__html:t.thinking?t.text:se(t.text)}},t.id))}),s.jsxs("form",{onSubmit:J,className:"p-3 border-t border-gray-200 dark:border-gray-800 flex gap-2 items-center",children:[s.jsxs("div",{className:"relative",children:[s.jsx("button",{type:"button",onClick:()=>O(t=>!t),className:"px-2 py-2 rounded-md border border-gray-300 text-gray-900 bg-white hover:bg-gray-100 dark:border-gray-700 dark:text-gray-100 dark:bg-[#1A1D24] dark:hover:bg-[#232734]",title:"Select project context",children:s.jsx(ne,{className:"w-4 h-4"})}),B&&s.jsxs("div",{className:"absolute left-0 bottom-12 w-80 bg-[#1E1E1E] text-gray-100 border border-gray-700 rounded-lg shadow-xl z-20 p-2 space-y-2 text-sm",children:[s.jsx("div",{className:"px-2 py-1 text-[11px] uppercase tracking-wide text-gray-400",children:"Project"}),N.map(t=>s.jsx("button",{type:"button",onClick:()=>{f(t.id),h([])},className:`w-full text-left px-2 py-1 rounded-md hover:bg-[#23262d] ${o===t.id?"bg-[#23262d]":""}`,children:s.jsxs("span",{className:"inline-flex items-center gap-2",children:[s.jsx(de,{className:"w-3.5 h-3.5"})," ",t.name]})},t.id)),s.jsx("div",{className:"px-2 pt-2 mt-2 border-t border-gray-700 text-[11px] uppercase tracking-wide text-gray-400",children:"Meetings"}),s.jsxs("div",{className:"max-h-44 overflow-auto space-y-1",children:[R.length===0&&s.jsx("div",{className:"px-2 py-1 text-gray-500",children:"No meetings in this project"}),R.map(t=>{const e=x.includes(t.id);return s.jsx("button",{type:"button",onClick:()=>h(a=>e?a.filter(r=>r!==t.id):[...a,t.id]),className:`w-full text-left px-2 py-1 rounded-md hover:bg-[#23262d] ${e?"bg-[#23262d]":""}`,children:t.title},t.id)})]}),s.jsx("div",{className:"px-2 pt-2 mt-2 border-t border-gray-700 text-[11px] uppercase tracking-wide text-gray-400",children:"Upload Transcript"}),s.jsxs("div",{className:"flex items-center gap-2 px-2 pb-1",children:[s.jsx("input",{type:"file",accept:"text/plain",className:"hidden",id:"agent-transcript-input",onChange:t=>{var r;const e=(r=t.target.files)==null?void 0:r[0];if(!e)return;const a=new FileReader;a.onload=()=>b(String(a.result||"")),a.readAsText(e)}}),s.jsx("button",{type:"button",onClick:()=>document.getElementById("agent-transcript-input").click(),className:"px-2 py-1 rounded-md bg-[#23262d] hover:bg-[#2b2f37]",children:"Choose .txt"}),m&&s.jsx("span",{className:"text-[11px] text-emerald-400",children:"Attached"})]}),s.jsx("div",{className:"flex justify-end gap-2 pt-1",children:s.jsx("button",{type:"button",onClick:()=>O(!1),className:"px-2 py-1 rounded-md bg-[#23262d] hover:bg-[#2b2f37]",children:"Done"})})]})]}),s.jsx("textarea",{value:C,onChange:t=>M(t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),J(t))},rows:1,className:"flex-1 rounded-2xl border border-gray-700 px-4 py-2 text-sm bg-[#1E1E1E] text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/30 resize-none",placeholder:`Type a message… (${w?w.name:"No project selected"})`}),s.jsx("button",{disabled:V,type:"submit",className:"p-2 rounded-full bg-emerald-500/90 text-white hover:bg-emerald-400 shadow-sm transition",children:s.jsx(le,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"px-3 pb-3 text-[11px] text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[s.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-gray-300 dark:border-gray-700",children:"Auto"}),w&&s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-gray-300 dark:border-gray-700",children:["Project: ",w.name]}),s.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full border border-gray-300 dark:border-gray-700",children:["Meetings: ",u?"On":"Off"]})]})]})]})};export{ge as default};
